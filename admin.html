<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin â€” Portfolio</title>
  <link rel="stylesheet" href="css.css" />
  <!-- Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨Ø§Øª Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
  <div class="bg"><div class="blob b1"></div><div class="blob b2"></div></div>

  <main class="wrap" style="max-width:760px">
    <section class="card" style="flex-direction:column;align-items:stretch">
      <h2 class="section-title">ğŸ” Espace Administrateur</h2>

      <div id="loginBlock">
        <input id="pwd" type="password" placeholder="Entrez le mot de passe" style="padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;margin-bottom:12px">
        <div style="display:flex;gap:10px">
          <button class="btn" onclick="login()">Se connecter</button>
          <button class="btn ghost" onclick="location.href='index.html'">Retour</button>
        </div>
      </div>

      <div id="adminPanel" style="display:none;margin-top:18px">
        <h3>â• Ajouter un projet 3D</h3>

        <input id="title" placeholder="Titre du projet" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
        <input id="desc" placeholder="Courte description" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
        
        <div style="margin:15px 0">
          <strong>ğŸ“ TÃ©lÃ©charger votre fichier 3D (.glb):</strong>
          <input type="file" id="glbFile" accept=".glb,.gltf" style="width:100%;padding:10px;margin:8px 0;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.1);color:inherit">
          <p style="font-size:0.85rem;color:var(--muted);margin:4px 0">
            Formats supportÃ©s: .glb (recommandÃ©), .gltf<br>
            Taille maximale: 50MB
          </p>
        </div>

        <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù -->
        <div id="filePreview" style="display:none; margin:15px 0; padding:15px; background:rgba(124,77,255,0.1); border-radius:8px;">
          <strong>ğŸ“Š AperÃ§u du fichier:</strong>
          <div id="fileInfo" style="margin-top:8px;"></div>
          <div id="modelPreview" style="height:200px; margin-top:10px; border-radius:6px; overflow:hidden; background:#000;"></div>
        </div>

        <div style="background:rgba(0,229,255,0.1);padding:15px;border-radius:8px;margin:15px 0;">
          <strong>ğŸ’¡ Comment exporter depuis Blender:</strong>
          <ol style="font-size:0.85rem; margin:8px 0; padding-left:20px;">
            <li>Ouvrez votre fichier .blend dans Blender</li>
            <li>File â†’ Export â†’ glTF 2.0 (.glb/.gltf)</li>
            <li>SÃ©lectionnez le format <strong>.glb</strong></li>
            <li>Cochez "Include Selected Objects" si nÃ©cessaire</li>
            <li>Cliquez "Export glTF 2.0"</li>
          </ol>
        </div>

        <div style="display:flex;gap:10px;margin-top:10px">
          <button class="btn" onclick="addProject()">âœ… Ajouter le Projet 3D</button>
          <button class="btn ghost" onclick="clearAll()">ğŸ—‘ï¸ Tout Supprimer</button>
          <button class="btn ghost" onclick="logout()">ğŸšª DÃ©connexion</button>
        </div>

        <h3 style="margin-top:18px">Projets 3D Actuels</h3>
        <div id="currentList" style="margin-top:10px"></div>
      </div>
    </section>
  </main>

  <script>
    const PASSWORD = 'manar2025';

    function login(){
      const v = document.getElementById('pwd').value;
      if(v === PASSWORD){
        document.getElementById('loginBlock').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        renderList();
      } else alert('Mot de passe incorrect !');
    }

    function logout(){
      document.getElementById('pwd').value = '';
      document.getElementById('loginBlock').style.display = 'block';
      document.getElementById('adminPanel').style.display = 'none';
    }

    // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
    document.getElementById('glbFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const fileInfo = document.getElementById('fileInfo');
        const filePreview = document.getElementById('filePreview');
        
        fileInfo.innerHTML = `
          <div>ğŸ“„ Nom: ${file.name}</div>
          <div>ğŸ“ Taille: ${(file.size / 1024 / 1024).toFixed(2)} MB</div>
          <div>ğŸ”§ Type: ${file.type || 'GLB/GLTF'}</div>
        `;
        
        filePreview.style.display = 'block';
        
        // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ù†Ù…ÙˆØ°Ø¬
        previewModel(file);
      }
    });

    function previewModel(file) {
      const previewContainer = document.getElementById('modelPreview');
      previewContainer.innerHTML = '<div style="color:white; text-align:center; padding:20px;">ğŸ”„ Chargement de l\'aperÃ§u...</div>';
      
      const url = URL.createObjectURL(file);
      const loader = new THREE.GLTFLoader();
      
      loader.load(
        url,
        function(gltf) {
          // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
          previewContainer.innerHTML = '';
          
          // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ù‡Ø¯
          const scene = new THREE.Scene();
          scene.background = new THREE.Color(0x0a0a12);
          
          const camera = new THREE.PerspectiveCamera(75, previewContainer.clientWidth / 200, 0.1, 1000);
          camera.position.z = 5;
          
          const renderer = new THREE.WebGLRenderer({ antialias: true });
          renderer.setSize(previewContainer.clientWidth, 200);
          previewContainer.appendChild(renderer.domElement);
          
          // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
          const model = gltf.scene;
          scene.add(model);
          
          // Ø¥Ø¶Ø§Ø¡Ø©
          const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
          scene.add(ambientLight);
          
          const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
          directionalLight.position.set(5, 5, 5);
          scene.add(directionalLight);
          
          // Ø¶Ø¨Ø· Ø§Ù„Ù…Ù‚ÙŠØ§Ø³
          const box = new THREE.Box3().setFromObject(model);
          const center = box.getCenter(new THREE.Vector3());
          const size = box.getSize(new THREE.Vector3());
          
          const maxDim = Math.max(size.x, size.y, size.z);
          const scale = 3 / maxDim;
          model.scale.multiplyScalar(scale);
          
          model.position.x = -center.x * scale;
          model.position.y = -center.y * scale;
          model.position.z = -center.z * scale;
          
          // ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
          const controls = new THREE.OrbitControls(camera, renderer.domElement);
          controls.enableDamping = true;
          
          function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
          }
          animate();
          
          // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
          setTimeout(() => URL.revokeObjectURL(url), 1000);
        },
        function(xhr) {
          console.log((xhr.loaded / xhr.total * 100) + '% chargÃ©');
        },
        function(error) {
          console.error('Erreur de chargement:', error);
          previewContainer.innerHTML = '<div style="color:#ff4444; text-align:center; padding:20px;">âŒ Erreur de chargement</div>';
        }
      );
    }

    function addProject(){
      const title = document.getElementById('title').value.trim();
      const desc = document.getElementById('desc').value.trim();
      const glbFile = document.getElementById('glbFile').files[0];
      
      if(!title || !desc){ 
        alert('Remplis le titre et la description !'); 
        return; 
      }

      if(!glbFile){ 
        alert('Veuillez sÃ©lectionner un fichier GLB !'); 
        return; 
      }

      // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù ÙƒÙ€ Data URL
      const reader = new FileReader();
      reader.onload = function(e) {
        const projectData = { 
          title, 
          desc, 
          type: 'glb',
          fileName: glbFile.name,
          fileSize: glbFile.size,
          fileData: e.target.result, // Stocker les donnÃ©es du fichier
          fileType: glbFile.type || 'model/gltf-binary'
        };

        let arr = [];
        try {
          arr = JSON.parse(localStorage.getItem('projects3d')) || [];
        } catch(e){
          arr = [];
        }

        arr.unshift(projectData);
        localStorage.setItem('projects3d', JSON.stringify(arr));

        // RÃ©initialiser le formulaire
        document.getElementById('title').value = '';
        document.getElementById('desc').value = '';
        document.getElementById('glbFile').value = '';
        document.getElementById('filePreview').style.display = 'none';
        
        renderList();
        alert('Projet 3D ajoutÃ© âœ…\nVotre modÃ¨le sera affichÃ© sur la page principale.');
      };
      
      reader.readAsDataURL(glbFile);
    }

    function renderList(){
      const list = document.getElementById('currentList');
      let arr = [];
      try {
        arr = JSON.parse(localStorage.getItem('projects3d')) || [];
      } catch(e){
        arr = [];
      }
      
      if(arr.length === 0){
        list.innerHTML = '<p class="muted">Aucun projet 3D enregistrÃ©.</p>';
        return;
      }
      
      list.innerHTML = arr.map((p,idx)=>`
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:10px;border:1px solid rgba(124,77,255,0.1)">
          <div style="flex:1">
            <strong>${p.title}</strong>
            <div class="muted" style="font-size:0.9rem">${p.desc}</div>
            <div style="font-size:0.8rem;color:#7c4dff">
              ğŸ“ ${p.fileName} â€¢ ${(p.fileSize / 1024 / 1024).toFixed(2)} MB
            </div>
          </div>
          <button class="btn ghost" onclick="removeAt(${idx})" style="padding:6px 12px">Suppr</button>
        </div>
      `).join('');
    }

    function removeAt(i){
      let arr = [];
      try { arr = JSON.parse(localStorage.getItem('projects3d')) || []; } catch(e){ arr = []; }
      if(!arr[i]) return;
      if(!confirm('Supprimer ce projet 3D ?')) return;
      
      arr.splice(i,1);
      localStorage.setItem('projects3d', JSON.stringify(arr));
      renderList();
    }

    function clearAll(){
      if(!confirm('Supprimer tous les projets 3D ?')) return;
      localStorage.removeItem('projects3d');
      renderList();
      alert('Tous les projets 3D supprimÃ©s.');
    }
  </script>
</body>
</html>
