<!-- اترك التصميم كما هو -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyCYhzsMUJX7Q7Zk58R28CS-8KZmZCdgrO4",
  authDomain: "portfolio-manar-ghemra.firebaseapp.com",
  projectId: "portfolio-manar-ghemra",
  storageBucket: "portfolio-manar-ghemra.appspot.com",
  messagingSenderId: "644022946013",
  appId: "1:644022946013:web:5465337e7d0f9546953334",
  measurementId: "G-6KJH3DTF6D"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

async function uploadFile(file, folder) {
  const storageRef = ref(storage, `${folder}/${Date.now()}_${file.name}`);
  await uploadBytes(storageRef, file);
  return storageRef.fullPath;
}

async function addProject() {
  const title = document.getElementById('title').value.trim();
  const desc = document.getElementById('desc').value.trim();
  if (!title || !desc) { alert('Remplis le titre et la description'); return; }

  const files = {};
  const blendFile = document.getElementById('blendFile').files[0];
  const imageFile = document.getElementById('imageFile').files[0];
  const videoFile = document.getElementById('videoFile').files[0];

  if (blendFile) files.blend = await uploadFile(blendFile, 'blends');
  if (imageFile) files.image = await uploadFile(imageFile, 'images');
  if (videoFile) files.video = await uploadFile(videoFile, 'videos');

  if (Object.keys(files).length === 0) { alert('Ajoute au moins un fichier'); return; }

  await addDoc(collection(db, 'projects'), { title, desc, files, date: serverTimestamp() });
  alert('Projet ajouté avec succès ✅');
  document.getElementById('title').value = '';
  document.getElementById('desc').value = '';
  document.getElementById('blendFile').value = '';
  document.getElementById('imageFile').value = '';
  document.getElementById('videoFile').value = '';
}
window.addProject = addProject;
</script>
