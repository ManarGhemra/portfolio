<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin ‚Äî Portfolio</title>
  <link rel="stylesheet" href="css.css" />
  <!-- ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÉÿ™ÿ®ÿßÿ™ Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DRACOLoader.js"></script>
</head>
<body>
  <div class="bg"><div class="blob b1"></div><div class="blob b2"></div></div>

  <main class="wrap" style="max-width:760px">
    <section class="card" style="flex-direction:column;align-items:stretch">
      <h2 class="section-title">üîê Espace Administrateur</h2>

      <div id="loginBlock">
        <input id="pwd" type="password" placeholder="Entrez le mot de passe" style="padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;margin-bottom:12px">
        <div style="display:flex;gap:10px">
          <button class="btn" onclick="login()">Se connecter</button>
          <button class="btn ghost" onclick="location.href='index.html'">Retour</button>
        </div>
      </div>

      <div id="adminPanel" style="display:none;margin-top:18px">
        <h3>‚ûï Ajouter un projet</h3>

        <input id="title" placeholder="Titre du projet" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
        <input id="desc" placeholder="Courte description" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
        
        <!-- Type de projet -->
        <div style="margin:12px 0">
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
            <input type="radio" name="projectType" value="link" checked onchange="toggleProjectType()">
            Lien du projet
          </label>
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
            <input type="radio" name="projectType" value="blender" onchange="toggleProjectType()">
            Projet 3D Blender
          </label>
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
            <input type="radio" name="projectType" value="media" onchange="toggleProjectType()">
            M√©dias (Images/Video)
          </label>
        </div>
        
        <!-- Lien -->
        <input id="link" placeholder="Lien du projet (https://...)" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
        
        <!-- Fichier Blender -->
        <div id="blenderInputContainer" style="display:none">
          <div style="margin:10px 0">
            <strong>Fichier Blender (.blend) - pour t√©l√©chargement:</strong>
            <input type="file" id="blendFile" accept=".blend" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
            <p style="font-size:0.85rem;color:var(--muted);margin:4px 0">Fichier .blend original</p>
          </div>
          
          <div style="margin:10px 0">
            <strong>Fichier pour visualisation 3D (OBJ/GLTF/GLB):</strong>
            <input type="file" id="modelFile" accept=".gltf,.glb,.obj,.mtl,.fbx" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
            <p style="font-size:0.85rem;color:var(--muted);margin:4px 0">
              Formats support√©s: .gltf, .glb, .obj (+.mtl), .fbx<br>
              <strong>Conseil:</strong> Exportez depuis Blender en GLB pour meilleure compatibilit√©
            </p>
          </div>

          <div style="margin:10px 0; padding:10px; background:rgba(124,77,255,0.1); border-radius:8px;">
            <strong>üìù Comment exporter depuis Blender:</strong>
            <ol style="font-size:0.85rem; margin:8px 0; padding-left:20px;">
              <li>Ouvrez votre fichier .blend dans Blender</li>
              <li>File ‚Üí Export ‚Üí glTF 2.0 (.glb/.gltf)</li>
              <li>Cochez "Selected Objects" si n√©cessaire</li>
              <li>Format: .glb (recommand√©)</li>
              <li>Include: Scene, Materials, Textures</li>
              <li>Cliquez "Export glTF 2.0"</li>
            </ol>
          </div>
        </div>

        <!-- M√©dias (Images/Video) -->
        <div id="mediaInputContainer" style="display:none">
          <input type="file" id="imageFile" accept=".png,.jpg,.jpeg,.webp" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
          <p style="font-size:0.85rem;color:var(--muted);margin:4px 0">Image (PNG, JPG, WebP)</p>
          
          <input type="file" id="videoFile" accept=".mp4,.webm,.mov" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
          <p style="font-size:0.85rem;color:var(--muted);margin:4px 0">Vid√©o (MP4, WebM, MOV) - Optionnel</p>
        </div>

        <div style="display:flex;gap:10px;margin-top:10px">
          <button class="btn" onclick="addProject()">Ajouter</button>
          <button class="btn ghost" onclick="clearAll()">Supprimer tout</button>
          <button class="btn ghost" onclick="logout()">Se d√©connecter</button>
        </div>

        <h3 style="margin-top:18px">Projets actuels</h3>
        <div id="currentList" style="margin-top:10px"></div>
      </div>
    </section>
  </main>

  <script>
    const PASSWORD = 'manar2025';

    function login(){
      const v = document.getElementById('pwd').value;
      if(v === PASSWORD){
        document.getElementById('loginBlock').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        renderList();
      } else alert('Mot de passe incorrect !');
    }

    function logout(){
      document.getElementById('pwd').value = '';
      document.getElementById('loginBlock').style.display = 'block';
      document.getElementById('adminPanel').style.display = 'none';
    }

    function toggleProjectType() {
      const projectType = document.querySelector('input[name="projectType"]:checked').value;
      const linkInput = document.getElementById('link');
      const blenderInputContainer = document.getElementById('blenderInputContainer');
      const mediaInputContainer = document.getElementById('mediaInputContainer');
      
      linkInput.style.display = projectType === 'link' ? 'block' : 'none';
      blenderInputContainer.style.display = projectType === 'blender' ? 'block' : 'none';
      mediaInputContainer.style.display = projectType === 'media' ? 'block' : 'none';
      
      linkInput.required = projectType === 'link';
    }

    function addProject(){
      const title = document.getElementById('title').value.trim();
      const desc = document.getElementById('desc').value.trim();
      const projectType = document.querySelector('input[name="projectType"]:checked').value;
      
      if(!title || !desc){ 
        alert('Remplis le titre et la description !'); 
        return; 
      }

      let projectData = { title, desc, type: projectType };

      if (projectType === 'link') {
        const link = document.getElementById('link').value.trim();
        if(!link || !isValidUrl(link)){ 
          alert('Ajoute un lien valide (https://...) pour ton projet !'); 
          return; 
        }
        projectData.link = link;
      } 
      else if (projectType === 'blender') {
        const blendInput = document.getElementById('blendFile');
        const modelInput = document.getElementById('modelFile');
        
        if(!blendInput.files.length){ 
          alert('Veuillez s√©lectionner un fichier Blender original !'); 
          return; 
        }
        
        if(!modelInput.files.length){ 
          alert('Veuillez s√©lectionner un fichier pour la visualisation 3D !'); 
          return; 
        }
        
        // Traitement fichier Blender
        const blendFile = blendInput.files[0];
        if (blendFile.size > 100 * 1024 * 1024) {
          alert('Le fichier Blender est trop volumineux (max 100MB) !');
          return;
        }
        const blendURL = URL.createObjectURL(blendFile);
        projectData.blendFile = blendURL;
        projectData.blendFileName = blendFile.name;
        
        // Traitement fichier mod√®le 3D
        const modelFile = modelInput.files[0];
        if (modelFile.size > 50 * 1024 * 1024) {
          alert('Le fichier mod√®le est trop volumineux (max 50MB) !');
          return;
        }
        
        const modelURL = URL.createObjectURL(modelFile);
        projectData.modelFile = modelURL;
        projectData.modelFileName = modelFile.name;
        projectData.modelFileType = modelFile.name.split('.').pop().toLowerCase();
      }
      else if (projectType === 'media') {
        const imageInput = document.getElementById('imageFile');
        const videoInput = document.getElementById('videoFile');
        
        if(!imageInput.files.length){ 
          alert('Veuillez s√©lectionner au moins une image !'); 
          return; 
        }
        
        const imageFile = imageInput.files[0];
        if (imageFile.size > 10 * 1024 * 1024) {
          alert('L\'image est trop volumineuse (max 10MB) !');
          return;
        }
        
        const imageURL = URL.createObjectURL(imageFile);
        projectData.imageFile = imageURL;
        projectData.imageName = imageFile.name;
        
        if(videoInput.files.length) {
          const videoFile = videoInput.files[0];
          if (videoFile.size > 50 * 1024 * 1024) {
            alert('La vid√©o est trop volumineuse (max 50MB) !');
            return;
          }
          const videoURL = URL.createObjectURL(videoFile);
          projectData.videoFile = videoURL;
          projectData.videoName = videoFile.name;
        }
      }

      // Sauvegarder
      let arr = [];
      try {
        arr = JSON.parse(localStorage.getItem('projects')) || [];
      } catch(e){
        arr = [];
      }

      arr.unshift(projectData);
      localStorage.setItem('projects', JSON.stringify(arr));

      // R√©initialiser
      document.getElementById('title').value = '';
      document.getElementById('desc').value = '';
      document.getElementById('link').value = '';
      document.getElementById('blendFile').value = '';
      document.getElementById('modelFile').value = '';
      document.getElementById('imageFile').value = '';
      document.getElementById('videoFile').value = '';
      document.querySelector('input[name="projectType"][value="link"]').checked = true;
      toggleProjectType();

      renderList();
      alert('Projet ajout√© ‚úÖ');
    }

    function renderList(){
      const list = document.getElementById('currentList');
      let arr = [];
      try {
        arr = JSON.parse(localStorage.getItem('projects')) || [];
      } catch(e){
        arr = [];
      }
      if(arr.length === 0){
        list.innerHTML = '<p class="muted">Aucun projet enregistr√©.</p>';
        return;
      }
      list.innerHTML = arr.map((p,idx)=>`
        <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 6px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:8px">
          <div style="flex:1">
            <strong>${escapeHtml(p.title)}</strong>
            <div class="muted" style="font-size:0.9rem">${escapeHtml(p.desc)}</div>
            ${p.type === 'blender' ? '<div style="font-size:0.8rem;color:#7c4dff">üéÆ Mod√®le 3D Interactif</div>' : ''}
            ${p.type === 'media' ? '<div style="font-size:0.8rem;color:#00e5ff">üñºÔ∏è M√©dias (Image/Video)</div>' : ''}
          </div>
          <div style="display:flex;gap:8px;margin-left:12px">
            <button class="btn ghost" onclick="removeAt(${idx})">Suppr</button>
          </div>
        </div>
      `).join('');
    }

    function removeAt(i){
      let arr = [];
      try { arr = JSON.parse(localStorage.getItem('projects')) || []; } catch(e){ arr = []; }
      if(!arr[i]) return;
      if(!confirm('Supprimer ce projet ?')) return;
      
      const project = arr[i];
      if (project.type === 'blender') {
        if (project.blendFile) URL.revokeObjectURL(project.blendFile);
        if (project.modelFile) URL.revokeObjectURL(project.modelFile);
      }
      if (project.type === 'media') {
        if (project.imageFile) URL.revokeObjectURL(project.imageFile);
        if (project.videoFile) URL.revokeObjectURL(project.videoFile);
      }
      
      arr.splice(i,1);
      localStorage.setItem('projects', JSON.stringify(arr));
      renderList();
    }

    function clearAll(){
      if(!confirm('Supprimer tous les projets ?')) return;
      
      let arr = [];
      try { arr = JSON.parse(localStorage.getItem('projects')) || []; } catch(e){ arr = []; }
      arr.forEach(project => {
        if (project.type === 'blender') {
          if (project.blendFile) URL.revokeObjectURL(project.blendFile);
          if (project.modelFile) URL.revokeObjectURL(project.modelFile);
        }
        if (project.type === 'media') {
          if (project.imageFile) URL.revokeObjectURL(project.imageFile);
          if (project.videoFile) URL.revokeObjectURL(project.videoFile);
        }
      });
      
      localStorage.removeItem('projects');
      renderList();
      alert('Tous les projets supprim√©s.');
    }

    function escapeHtml(s){ 
      if(!s) return ''; 
      return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); 
    }

    function isValidUrl(s){
      try {
        const u = new URL(s);
        return u.protocol === 'http:' || u.protocol === 'https:';
      } catch(e){
        return false;
      }
    }

    document.addEventListener('DOMContentLoaded', ()=> {
      toggleProjectType();
    });
  </script>
</body>
</html>
