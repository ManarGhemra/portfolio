<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin ‚Äî Portfolio</title>
  <link rel="stylesheet" href="css.css" />
</head>
<body>
  <div class="bg"><div class="blob b1"></div><div class="blob b2"></div></div>

  <main class="wrap" style="max-width:760px">
    <section class="card" style="flex-direction:column;align-items:stretch">
      <h2 class="section-title">üîê Espace Administrateur</h2>

      <div id="loginBlock">
        <input id="pwd" type="password" placeholder="Entrez le mot de passe" style="padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;margin-bottom:12px">
        <div style="display:flex;gap:10px">
          <button class="btn" onclick="login()">Se connecter</button>
          <button class="btn ghost" onclick="location.href='index.html'">Retour</button>
        </div>
      </div>

      <div id="adminPanel" style="display:none;margin-top:18px">
        <h3>‚ûï Ajouter un projet</h3>

        <input id="title" placeholder="Titre du projet" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
        <input id="desc" placeholder="Courte description" style="width:100%;padding:10px;margin:6px 0;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
        
        <!-- Section pour les fichiers -->
        <div style="margin:12px 0">
          <h4 style="margin-bottom:8px">Fichiers du projet (liens externes)</h4>
          
          <div style="margin-bottom:10px">
            <label style="display:block;margin-bottom:6px">Lien du fichier Blender</label>
            <input type="url" id="blendLink" placeholder="https://drive.google.com/... ou https://dropbox.com/..." style="width:100%;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
            <p style="font-size:0.85rem;color:var(--muted);margin:4px 0">Utilisez Google Drive, Dropbox, ou autre service de stockage</p>
          </div>
          
          <div style="margin-bottom:10px">
            <label style="display:block;margin-bottom:6px">Lien de l'image</label>
            <input type="url" id="imageLink" placeholder="https://..." style="width:100%;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
          </div>
          
          <div style="margin-bottom:10px">
            <label style="display:block;margin-bottom:6px">Lien de la vid√©o</label>
            <input type="url" id="videoLink" placeholder="https://..." style="width:100%;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
          </div>
        </div>

        <div style="background:rgba(255,255,255,0.05);padding:12px;border-radius:8px;margin:12px 0">
          <h4 style="color:var(--accent2);margin-bottom:8px">üí° Instructions importantes</h4>
          <p style="font-size:0.9rem;color:var(--muted);margin:0">
            1. T√©l√©chargez vos fichiers sur <strong>Google Drive</strong>, <strong>Dropbox</strong> ou autre<br>
            2. Copiez le lien de partage public<br>
            3. Collez les liens dans les champs ci-dessus
          </p>
        </div>

        <div style="display:flex;gap:10px;margin-top:10px">
          <button class="btn" onclick="addProject()">Ajouter</button>
          <button class="btn ghost" onclick="clearAll()">Supprimer tout</button>
          <button class="btn ghost" onclick="logout()">Se d√©connecter</button>
        </div>

        <h3 style="margin-top:18px">Projets actuels</h3>
        <div id="currentList" style="margin-top:10px"></div>
      </div>
    </section>
  </main>

  <script>
    const PASSWORD = 'manar2025';

    function login(){
      const v = document.getElementById('pwd').value;
      if(v === PASSWORD){
        document.getElementById('loginBlock').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        renderList();
      } else alert('Mot de passe incorrect !');
    }

    function logout(){
      document.getElementById('pwd').value = '';
      document.getElementById('loginBlock').style.display = 'block';
      document.getElementById('adminPanel').style.display = 'none';
    }

    function addProject(){
      const title = document.getElementById('title').value.trim();
      const desc = document.getElementById('desc').value.trim();
      const blendLink = document.getElementById('blendLink').value.trim();
      const imageLink = document.getElementById('imageLink').value.trim();
      const videoLink = document.getElementById('videoLink').value.trim();
      
      if(!title || !desc){ 
        alert('Remplis le titre et la description !'); 
        return; 
      }

      if(!blendLink && !imageLink && !videoLink) {
        alert('Ajoute au moins un lien vers un fichier !');
        return;
      }

      const projectData = { 
        title, 
        desc, 
        links: {},
        date: new Date().toISOString()
      };

      // Traiter les liens
      if (blendLink && isValidUrl(blendLink)) {
        projectData.links.blend = blendLink;
      } else if (blendLink) {
        alert('Lien Blender invalide !');
        return;
      }

      if (imageLink && isValidUrl(imageLink)) {
        projectData.links.image = imageLink;
      } else if (imageLink) {
        alert('Lien image invalide !');
        return;
      }

      if (videoLink && isValidUrl(videoLink)) {
        projectData.links.video = videoLink;
      } else if (videoLink) {
        alert('Lien vid√©o invalide !');
        return;
      }

      // R√©cup√©rer les projets existants
      let arr = [];
      try {
        const stored = localStorage.getItem('projects');
        arr = stored ? JSON.parse(stored) : [];
      } catch(e){
        arr = [];
      }

      // Ajouter le nouveau projet
      arr.unshift(projectData);
      
      try {
        localStorage.setItem('projects', JSON.stringify(arr));
      } catch(e) {
        alert('Erreur lors de la sauvegarde !');
        return;
      }

      // R√©initialiser champs
      document.getElementById('title').value = '';
      document.getElementById('desc').value = '';
      document.getElementById('blendLink').value = '';
      document.getElementById('imageLink').value = '';
      document.getElementById('videoLink').value = '';

      renderList();
      alert('Projet ajout√© ‚úÖ');
    }

    function renderList(){
      const list = document.getElementById('currentList');
      let arr = [];
      try {
        const stored = localStorage.getItem('projects');
        arr = stored ? JSON.parse(stored) : [];
      } catch(e){
        arr = [];
      }
      
      if(arr.length === 0){
        list.innerHTML = '<p class="muted">Aucun projet enregistr√©.</p>';
        return;
      }
      
      list.innerHTML = arr.map((p,idx)=>`
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:10px;border:1px solid rgba(255,255,255,0.05)">
          <div style="flex:1">
            <strong style="color:var(--accent1);font-size:1.1rem">${escapeHtml(p.title)}</strong>
            <div class="muted" style="font-size:0.9rem;margin:4px 0">${escapeHtml(p.desc)}</div>
            <div style="font-size:0.8rem;color:var(--muted);margin-top:6px">
              ${p.links.blend ? 'üìÅ Blender ‚Ä¢ ' : ''}
              ${p.links.image ? 'üñº Image ‚Ä¢ ' : ''}
              ${p.links.video ? 'üé¨ Vid√©o' : ''}
            </div>
          </div>
          <div style="display:flex;gap:8px;margin-left:12px">
            <button class="btn ghost" onclick="removeProject(${idx})" style="padding:6px 12px;font-size:0.8rem">Supprimer</button>
          </div>
        </div>
      `).join('');
    }

    function removeProject(index){
      let arr = [];
      try {
        const storedData = localStorage.getItem('projects');
        arr = storedData ? JSON.parse(storedData) : [];
      } catch(e) {
        arr = [];
      }
      
      if(index < 0 || index >= arr.length){
        alert('Erreur: Projet non trouv√© !');
        return;
      }
      
      const projectToDelete = arr[index];
      
      if(!confirm('Supprimer le projet "' + projectToDelete.title + '" ?')) {
        return;
      }
      
      arr.splice(index, 1);
      localStorage.setItem('projects', JSON.stringify(arr));
      renderList();
      alert('Projet supprim√© avec succ√®s !');
    }

    function clearAll(){
      if(!confirm('Supprimer TOUS les projets ? Cette action est irr√©versible !')) return;
      
      localStorage.removeItem('projects');
      renderList();
      alert('Tous les projets ont √©t√© supprim√©s.');
    }

    // utilitaires
    function escapeHtml(s){ 
      if(!s) return ''; 
      return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); 
    }

    function isValidUrl(string) {
      try {
        const url = new URL(string);
        return url.protocol === 'http:' || url.protocol === 'https:';
      } catch (_) {
        return false;
      }
    }

    document.addEventListener('DOMContentLoaded', ()=> {
      console.log('Admin panel loaded');
    });
  </script>
</body>
</html>
